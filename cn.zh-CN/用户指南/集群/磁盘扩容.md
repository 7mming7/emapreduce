# 磁盘扩容 {#concept_f3v_bw4_y2b .concept}

如果业务发展中发现数据存储空间不够了，EMR 3.11.0及以上版本的集群可以在集群详情页对磁盘直接进行扩容来实现。

## 扩容入口 {#section_bp2_hjc_wfb .section}

在集群管理页上，找到需要扩展的集群条目，单击**详情**，然后在详情页的右上角单击**扩容/缩容**，在下拉框中选择**磁盘扩容**。

选择需要进行磁盘扩容的实例组。

**说明：** 确保账号余额充足，扩容数据盘自动扣款，如果余额不够时，扩容数据盘流程会中断。

## 扩容界面 {#section_zjf_h4n_y2b .section}

如下图所示：

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/17864/155012696132531_zh-CN.png)

-   配置：当前实例组数据盘的配置。
-   扩容至：扩容后数据盘大小。

**说明：** 

-   目前，只支持扩容，不支持缩容。
-   磁盘扩容目前只支持数据盘扩容。

## 重启集群 {#section_ap5_klt_cgb .section}

1.  扩容结束后，在对应的机器组（比如：Core）会提示“扩容磁盘已完成，机器组待重启”。如下图所示：

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/17864/155012696134253_zh-CN.png)

2.  单击**扩容磁盘已完成，机器组待重启**。如下图所示：

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/17864/155012696134254_zh-CN.png)

    **说明：** 重启集群会重启集群的ECS实例，所以重启中的ECS实例上的大数据服务不可用，请务必确保不影响业务的情况下操作

    -   滚动重启
        -   勾选表示一个ECS实例重启完成且该实例上的大数据服务全部恢复后再启动下一个ECS实例。每个节点重启耗时约5分钟
        -   不勾选表示同时重启所有ECS实例
    -   只重启变配节点
        -   变配节点，指已经完成过扩容磁盘或者升级配置操作的节点（如：CORE，MASTER等）
        -   勾选表示只重启变配节点，未变配的节点不会被重启。例如：只是对CORE组的节点做了磁盘扩容，但未对MASTER扩容磁盘和升级配 置操作，那么只会重启CORE组下的ECS实例，不会重启MASTER组下的ECS实例
        -   不勾选表示所有节点都将重启。即：集群下的所有机器都会被重启
3.  重启过程中，在对应的机器组（比如：CORE）会提示“机器组重启中”，如下图所示：

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/17864/155012696134255_zh-CN.png)

4.  待步骤3的提示消失后，扩容数据盘全部完成并生效。可以登录集群查验。

## 节点数据盘扩容 {#section_rws_wx4_y2b .section}

EMR 3.11.0以下版本的集群可以通过在ECS控制台上对磁盘进行扩容。

1.  登录EMR控制台，在集群列表中找到待扩容的集群，单击**详情**进入集群详情页面。
2.  查看集群中的待扩容的 Core 节点的 ECS Id，类似 i-bp1bsithym5hh9h93xxx。默认的情况下，在扩容的时候，请将集群中所有的节点磁盘都进行统一的扩容，保证集群内部的节点的磁盘容量都是一致的。
3.  复制 ECS Id，并前往 ECS 控制台。 选择左侧的**实例**标签，然后在搜索中选择实例 Id 并输入 ECS Id。 注意要选择相同的地域。
4.  找到对应的 ECS 节点后，单击**管理**，进入实例详情页面，然后点击左侧的**本实例磁盘**标签。
5.  扩容数据磁盘。 由于目前无法指定多个磁盘批量扩容，所以需要对每一个磁盘重复如下的扩容操作。
6.  首先在 ECS 控制台，扩容所有磁盘，并重启节点。
7.  参考 [ECS 磁盘扩容说明](../../../../../intl.zh-CN/用户指南/云盘/扩容云盘/扩容数据盘_Linux.md#) 进行磁盘扩容。

    **说明：** 这里umount操作失败的时候，需要先在集群上关闭 YARN 和 HDFS 服务。另外在 Disk1 操作的时候可能会碰到 ilogtail 写日志而无法 umount 的情况。需要通过 sudo pgrep ilogtail | sudo xargs kill 将 ilogtail 暂时杀掉。后续可以通过重启节点来恢复 ilogtail 服务。

8.  完成以后在节点通过 df -h 命令，能够看到所有的磁盘都完成了扩容。
9.  为了保证在后续的 EMR 扩容过程中使磁盘能和扩容后的一致，请工单联系我们扩容事项，我们进行集群数据更新。

## 节点系统盘扩容 {#section_nzr_sy4_y2b .section}

系统盘扩容是一个比较复杂的操作，如无必要尽量避免操作。

1.  在EMR控制台上点击进入待扩容的集群详情页面。
2.  查看集群中的待扩容的 Master 节点的 ECS Id，类似 i-bp1bsithym5hh9h93xxx。默认的情况下，在扩容的时候，请将集群中所有的节点磁盘都进行统一的扩容，保证集群内部的节点的磁盘容量都是一致的。
3.  复制 ECS Id，并前往 ECS 控制台。 选择左侧的**实例**标签，然后在搜索中选择实例 Id 并输入 ECS Id。 注意要选择相同的地域。
4.  找到对应的 ECS 节点后，单击**管理**，进入实例详情页面，然后点击左侧的**本实例磁盘**标签。
5.  找到系统磁盘。系统磁盘只会有一块。
6.  参考 [ECS 系统盘扩容说明](../../../../../intl.zh-CN/用户指南/云盘/扩容云盘/扩容系统盘.md#) 进行系统盘扩容。

    **说明：** 

    -   对于非HA集群，扩容系统盘会导致集群在扩容期间不可用。
    -   扩容完成以后，因为ECS会做一些磁盘的处理，可能会导致节点的 /etc/hosts 文件变化，需要在扩容完成以后修复。另外ssh的免登也会被破坏，但这个不会影响服务本身，可以手动修复。

