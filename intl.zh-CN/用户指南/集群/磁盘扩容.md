# 磁盘扩容 {#concept_f3v_bw4_y2b .concept}

目前EMR还没有直接在产品上支持磁盘的扩容，如果业务发展中发现数据存储空间不够了，可以通过在ECS控制台上，对磁盘直接进行扩容来实现。

参考步骤如下：

## 节点数据盘扩容 {#section_rws_wx4_y2b .section}

1.  在EMR控制台上点击进入待扩容的集群详情页面。
2.  查看集群中的待扩容的 Core 节点的 ECS Id，类似 i-bp1bsithym5hh9h93xxx。默认的情况下，在扩容的时候，请将集群中所有的节点磁盘都进行统一的扩容，保证集群内部的节点的磁盘容量都是一致的。
3.  复制 ECS Id，并前往 ECS 控制台。 选择左侧的**实例**标签，然后在搜索中选择实例 Id 并输入 ECS Id。 注意要选择相同的地域。
4.  找到对应的 ECS 节点后，单击**管理**，进入实例详情页面，然后点击左侧的**本实例磁盘**标签。
5.  扩容数据磁盘。 由于目前无法指定多个磁盘批量扩容，所以需要对每一个磁盘重复如下的扩容操作。
6.  首先在 ECS 控制台，扩容所有磁盘，并重启节点。
7.  参考 [ECS 磁盘扩容说明](https://help.aliyun.com/document_detail/25452.html) 进行磁盘扩容。

    **说明：** 这里umount操作失败的时候，需要先在集群上关闭 YARN 和 HDFS 服务。另外在 Disk1 操作的时候可能会碰到 ilogtail 写日志而无法 umount 的情况。需要通过 sudo pgrep ilogtail | sudo xargs kill 将 ilogtail 暂时杀掉。后续可以通过重启节点来恢复 ilogtail 服务。

8.  完成以后在节点通过 df -h 命令，能够看到所有的磁盘都完成了扩容。
9.  为了保证在后续的 EMR 扩容过程中使磁盘能和扩容后的一致，请工单联系我们扩容事项，我们进行集群数据更新。

## 节点系统盘扩容 {#section_nzr_sy4_y2b .section}

系统盘扩容是一个比较复杂的操作，如无必要尽量避免操作。

1.  在EMR控制台上点击进入待扩容的集群详情页面。
2.  查看集群中的待扩容的 Master 节点的 ECS Id，类似 i-bp1bsithym5hh9h93xxx。默认的情况下，在扩容的时候，请将集群中所有的节点磁盘都进行统一的扩容，保证集群内部的节点的磁盘容量都是一致的。
3.  复制 ECS Id，并前往 ECS 控制台。 选择左侧的**实例**标签，然后在搜索中选择实例 Id 并输入 ECS Id。 注意要选择相同的地域。
4.  找到对应的 ECS 节点后，单击**管理**，进入实例详情页面，然后点击左侧的**本实例磁盘**标签。
5.  找到系统磁盘。系统磁盘只会有一块。
6.  参考 [ECS 系统盘扩容说明](https://help.aliyun.com/document_detail/44986.html) 进行系统盘扩容。

    **说明：** 

    -   对于非HA集群，扩容系统盘会导致集群在扩容期间不可用。
    -   扩容完成以后，因为ECS会做一些磁盘的处理，可能会导致节点的 /etc/hosts 文件变化，需要在扩容完成以后修复。另外ssh的免登也会被破坏，但这个不会影响服务本身，可以手动修复。

